<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>RYANAIR VIRTUAL LIVE MAP</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
html, body {
  height: 100%;
  margin: 0;
  background: #0e1a2b;
}

#map {
  height: 100%;
}

.leaflet-popup-content {
  font-family: Arial;
  font-size: 13px;
}
</style>
</head>

<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const API_KEY = "EC5j4KH1v6QNhTVlcCRZ2dvhQgXccMf5";
const VA_PREFIX = "RYR";   // Callsign prefix değiştirilebilir
const REFRESH_INTERVAL = 30000; // 30 saniye

const map = L.map('map').setView([50, 10], 4);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);

let markers = [];

function clearMarkers() {
  markers.forEach(marker => map.removeLayer(marker));
  markers = [];
}

function loadFlights() {
  fetch(`https://api.infiniteflight.com/public/v2/flights?apikey=${API_KEY}`)
  .then(res => res.json())
  .then(data => {

    clearMarkers();

    if (!data.result) return;

    data.result.forEach(flight => {

      if (!flight.callsign) return;
      if (!flight.callsign.startsWith(VA_PREFIX)) return;
      if (!flight.latitude || !flight.longitude) return;

      const marker = L.marker([flight.latitude, flight.longitude]).addTo(map);

      marker.bindPopup(`
        <b>${flight.callsign}</b><br>
        Aircraft: ${flight.aircraftId}<br>
        Altitude: ${Math.round(flight.altitude)} ft<br>
        Speed: ${Math.round(flight.speed)} kts<br>
        From: ${flight.departureAirportId}<br>
        To: ${flight.arrivalAirportId}
      `);

      markers.push(marker);
    });
  });
}

loadFlights();
setInterval(loadFlights, REFRESH_INTERVAL);

</script>

</body>
</html>
